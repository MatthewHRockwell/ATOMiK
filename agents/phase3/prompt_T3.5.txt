You are implementing Phase 3, Task T3.5 of the ATOMiK project.

FIRST: Read these context files:
- specs/rtl_architecture.md (design specification)
- rtl/atomik_core_v2.v (integrated core from T3.4)
- rtl/atomik_delta_acc.v (accumulator)
- rtl/atomik_state_rec.v (reconstructor)
- experiments/benchmarks/atomik/delta_engine.py (Python reference model)
- sim/tb_delta_acc.v (existing accumulator testbench)
- sim/tb_state_rec.v (existing reconstructor testbench)

CONTEXT:
- All RTL modules are implemented (T3.2-T3.4)
- Now we need comprehensive verification of the integrated system
- Tests must verify equivalence with Python reference model
- This is critical: hardware must behave identically to validated software

TASK T3.5: Create Comprehensive Simulation Suite

1. **Top-Level Testbench**: Create sim/tb_atomik_core.v

   Test cases (each should be a separate task block with clear pass/fail):
   
   a) **Reset Test**
      - Apply reset, verify accumulator=0, state_out=initial_state
   
   b) **Single Delta Accumulation**
      - Load initial_state = 0x123456789ABCDEF0
      - Apply delta = 0xFEDCBA0987654321
      - Verify accumulator = delta
      - Read state, verify = initial XOR delta
   
   c) **Multiple Delta Chain**
      - Apply 10 deltas in sequence
      - Verify final accumulator = XOR of all deltas
      - Verify state = initial XOR accumulator
   
   d) **Self-Inverse Property**
      - Apply delta, then apply same delta again
      - Verify accumulator = 0 (delta XOR delta = 0)
      - This validates the Phase 1 proven property
   
   e) **Commutativity Test**
      - Apply deltas in order: A, B, C
      - Reset, apply deltas in order: C, A, B
      - Verify same final accumulator
      - This validates delta_comm from Phase 1
   
   f) **Interleaved Read/Write**
      - Apply delta, read state, apply delta, read state...
      - Verify each read returns correct state
   
   g) **Back-to-Back Operations**
      - Apply deltas on consecutive cycles (no gaps)
      - Verify all are accumulated correctly
   
   h) **Boundary Values**
      - Test with: 0x0, 0xFFFFFFFFFFFFFFFF, 0xAAAAAAAAAAAAAAAA, 0x5555555555555555
   
   i) **Long Sequence** (100 deltas)
      - Generate 100 random deltas
      - Apply all, verify final state matches Python reference

2. **Python Reference Model**: Create sim/reference_model.py
```python
#!/usr/bin/env python3
"""Generate test vectors matching delta_engine.py behavior."""

import random

def generate_test_vectors(filename, num_deltas=100, seed=42):
    random.seed(seed)
    initial_state = random.getrandbits(64)
    deltas = [random.getrandbits(64) for _ in range(num_deltas)]
    
    # Compute expected results
    accumulator = 0
    for d in deltas:
        accumulator ^= d
    final_state = initial_state ^ accumulator
    
    # Write test vector file
    with open(filename, 'w') as f:
        f.write(f"// Initial state: {initial_state:016X}\n")
        f.write(f"// Expected final accumulator: {accumulator:016X}\n")
        f.write(f"// Expected final state: {final_state:016X}\n")
        f.write(f"{initial_state:016X}\n")
        for d in deltas:
            f.write(f"{d:016X}\n")
    
    return initial_state, accumulator, final_state

if __name__ == "__main__":
    generate_test_vectors("vectors/test_sequence.hex")
    print("Test vectors generated")
```

3. **Test Vector Files**: Create sim/vectors/
   - test_basic.hex (manual test cases)
   - test_boundary.hex (boundary values)
   - test_sequence.hex (generated by reference_model.py)

4. **Master Verification Script**: Create sim/run_all_tests.sh
```bash
#!/bin/bash
set -e
cd "$(dirname "$0")"

echo "=========================================="
echo "ATOMiK Phase 3 Simulation Test Suite"
echo "=========================================="

# Generate test vectors
echo "[1/4] Generating test vectors..."
python3 reference_model.py

# Run individual module tests
echo "[2/4] Running delta accumulator tests..."
./run_delta_acc.sh

echo "[3/4] Running state reconstructor tests..."
./run_state_rec.sh

# Run integrated core tests
echo "[4/4] Running integrated core tests..."
iverilog -o sim_core \
    ../rtl/atomik_core_v2.v \
    ../rtl/atomik_delta_acc.v \
    ../rtl/atomik_state_rec.v \
    tb_atomik_core.v
vvp sim_core

echo "=========================================="
echo "ALL TESTS PASSED"
echo "=========================================="
```

5. **Waveform Generation**: Add to testbenches:
```verilog
initial begin
    $dumpfile("atomik_core.vcd");
    $dumpvars(0, tb_atomik_core);
end
```

6. **Results Documentation**: Create sim/SIMULATION_RESULTS.md

Template:
```markdown
# ATOMiK Phase 3 Simulation Results

## Test Summary

| Test | Status | Notes |
|------|--------|-------|
| Reset | ? | |
| Single Delta | ? | |
| Multiple Delta Chain | ? | |
| Self-Inverse | ? | |
| Commutativity | ? | |
| Interleaved R/W | ? | |
| Back-to-Back | ? | |
| Boundary Values | ? | |
| Long Sequence (100) | ? | |

## Waveform Analysis

[Screenshots to be added after running tests]

## Equivalence to Python Reference

Verified that hardware output matches experiments/benchmarks/atomik/delta_engine.py
for all test vectors.
```

Output files:
- sim/tb_atomik_core.v
- sim/reference_model.py
- sim/vectors/test_basic.hex
- sim/vectors/test_boundary.hex
- sim/run_all_tests.sh (make executable with chmod +x)
- sim/SIMULATION_RESULTS.md

After running tests, update SIMULATION_RESULTS.md with actual results.

Update .github/atomik-status.yml to mark T3.5_simulation_verification: complete
